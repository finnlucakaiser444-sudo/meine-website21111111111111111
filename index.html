<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066ff;
            --primary-light: #e6f0ff;
            --secondary: #f5f5f5;
            --destructive: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --border: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecf1 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Navigation */
        nav {
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .nav-brand-icon {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: color 0.3s;
            border-bottom: 2px solid transparent;
            padding-bottom: 0.25rem;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0052cc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #f0f0f0;
        }

        .btn-danger {
            background: var(--destructive);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.25rem 0.75rem;
            font-size: 0.85rem;
        }

        /* Main Content */
        main {
            padding: 2rem 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Home Page */
        .hero {
            text-align: center;
            padding: 3rem 0;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .feature-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .feature-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .iserv-section {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }

        .iserv-section h2 {
            margin-bottom: 0.5rem;
        }

        .iserv-section p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Game Page */
        .game-container {
            background: var(--bg);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        #gameCanvas {
            width: 100%;
            max-width: 800px;
            height: 400px;
            background: linear-gradient(180deg, #87ceeb 0%, #e0f6ff 100%);
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            border: 2px solid var(--border);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--secondary);
            border-radius: 8px;
        }

        .game-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .game-controls {
            text-align: center;
            margin-top: 1rem;
        }

        .leaderboard {
            background: var(--bg);
            border-radius: 12px;
            padding: 2rem;
        }

        .leaderboard h2 {
            margin-bottom: 1rem;
        }

        .leaderboard-list {
            list-style: none;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .leaderboard-rank {
            font-weight: bold;
            color: var(--primary);
            min-width: 30px;
        }

        /* Homework Page */
        .homework-section {
            background: var(--bg);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .homework-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .homework-header h2 {
            font-size: 1.5rem;
        }

        .homework-form {
            background: var(--secondary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .homework-list {
            list-style: none;
        }

        .homework-item {
            background: var(--secondary);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .homework-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .homework-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .homework-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .homework-meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .homework-description {
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .homework-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .due-date-warning {
            color: var(--warning);
            font-weight: 600;
        }

        .due-date-overdue {
            color: var(--destructive);
            font-weight: 600;
        }

        /* Notes Page */
        .notes-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .notes-form {
            background: var(--bg);
            border-radius: 12px;
            padding: 2rem;
            height: fit-content;
        }

        .notes-form h2 {
            margin-bottom: 1rem;
        }

        .notes-list {
            background: var(--bg);
            border-radius: 12px;
            padding: 2rem;
        }

        .notes-list h2 {
            margin-bottom: 1rem;
        }

        .note-card {
            background: var(--secondary);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 6px;
        }

        .note-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .note-content {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }

        .note-date {
            font-size: 0.8rem;
            color: #999;
        }

        /* Chat Page */
        .chat-container {
            background: var(--bg);
            border-radius: 12px;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--secondary);
            border-radius: 8px;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 6px;
            border-left: 3px solid var(--primary);
        }

        .message-author {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .message-content {
            margin-top: 0.25rem;
            color: var(--text-primary);
        }

        .message-time {
            font-size: 0.8rem;
            color: #999;
            margin-top: 0.25rem;
        }

        .chat-input-area {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input-area input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                gap: 1rem;
                font-size: 0.9rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .notes-container {
                grid-template-columns: 1fr;
            }

            .chat-container {
                height: 400px;
            }
        }

        .hidden {
            display: none !important;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <div class="nav-content">
                <div class="nav-brand">
                    <div class="nav-brand-icon">S</div>
                    <span>Student Portal</span>
                </div>
                <ul class="nav-links">
                    <li><a onclick="switchPage('home')" class="nav-link active">Home</a></li>
                    <li><a onclick="switchPage('game')" class="nav-link">Spiel</a></li>
                    <li><a onclick="switchPage('homework')" class="nav-link">Hausaufgaben</a></li>
                    <li><a onclick="switchPage('notes')" class="nav-link">Notizen</a></li>
                    <li><a onclick="switchPage('chat')" class="nav-link">Chat</a></li>
                    <li><a href="https://hrsaaf.de/iserv" target="_blank" class="nav-link">iServ ‚Üó</a></li>
                </ul>
                <div class="nav-right">
                    <div class="user-info">
                        <span id="userName">Gast</span>
                        <span id="userRole" style="font-size: 0.8rem; color: var(--text-secondary);"></span>
                    </div>
                    <button class="btn btn-secondary btn-small" onclick="toggleLoginModal()">Anmelden</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Home Page -->
            <div id="home" class="page active">
                <div class="hero">
                    <h1>Dein Student Portal</h1>
                    <p>Alles was du f√ºr die Schule brauchst, an einem Ort. Spiele, Hausaufgaben, Notizen und mehr.</p>
                </div>

                <div class="features-grid">
                    <div class="feature-card" onclick="switchPage('game')">
                        <div class="feature-icon">üéÆ</div>
                        <h3>Spiel</h3>
                        <p>Spiele Geometry Dash und entspanne dich zwischen den Hausaufgaben</p>
                    </div>
                    <div class="feature-card" onclick="switchPage('homework')">
                        <div class="feature-icon">üìö</div>
                        <h3>Hausaufgaben</h3>
                        <p>Gib den Code ein und sieh dir alle Hausaufgaben an</p>
                    </div>
                    <div class="feature-card" onclick="switchPage('notes')">
                        <div class="feature-icon">üìù</div>
                        <h3>Notizen</h3>
                        <p>Deine pers√∂nlichen Notizen, nur f√ºr dich sichtbar</p>
                    </div>
                    <div class="feature-card" onclick="switchPage('chat')">
                        <div class="feature-icon">üí¨</div>
                        <h3>Chat</h3>
                        <p>Chatte mit deinen Mitsch√ºlern in Echtzeit</p>
                    </div>
                </div>

                <div class="iserv-section">
                    <h2>Schnellzugriff</h2>
                    <p>Direkter Link zu deinem iServ</p>
                    <a href="https://hrsaaf.de/iserv" target="_blank" class="btn btn-primary">Zu iServ ‚Üó</a>
                </div>
            </div>

            <!-- Game Page -->
            <div id="game" class="page">
                <div class="game-container">
                    <h2>Geometry Dash</h2>
                    <canvas id="gameCanvas"></canvas>
                    <div class="game-info">
                        <div>
                            <span style="color: var(--text-secondary);">Punkte: </span>
                            <span class="game-score" id="gameScore">0</span>
                        </div>
                        <div class="game-controls">
                            <button class="btn btn-primary btn-small" onclick="startGame()">Starten</button>
                            <button class="btn btn-secondary btn-small" onclick="resetGame()">Zur√ºcksetzen</button>
                        </div>
                    </div>
                </div>

                <div class="leaderboard">
                    <h2>üèÜ Top Spieler</h2>
                    <ul class="leaderboard-list" id="leaderboard">
                        <li class="leaderboard-item">
                            <span class="leaderboard-rank">1.</span>
                            <span>Noch keine Scores</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Homework Page -->
            <div id="homework" class="page">
                <div class="homework-section">
                    <div class="homework-header">
                        <h2>Hausaufgaben</h2>
                        <button class="btn btn-primary btn-small" onclick="toggleTeacherModal()">Lehrer Modus</button>
                    </div>

                    <div id="teacherForm" class="homework-form hidden">
                        <h3>Neue Hausaufgabe erstellen</h3>
                        <div class="form-group">
                            <label>Titel</label>
                            <input type="text" id="hwTitle" placeholder="z.B. Mathematik Aufgaben">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Fach</label>
                                <input type="text" id="hwSubject" placeholder="z.B. Mathematik">
                            </div>
                            <div class="form-group">
                                <label>F√§lligkeitsdatum</label>
                                <input type="date" id="hwDueDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Beschreibung</label>
                            <textarea id="hwDescription" placeholder="Beschreibe die Aufgabe..."></textarea>
                        </div>
                        <div class="form-row">
                            <button class="btn btn-primary" onclick="createHomework()">Erstellen</button>
                            <button class="btn btn-secondary" onclick="toggleTeacherForm()">Abbrechen</button>
                        </div>
                    </div>

                    <ul class="homework-list" id="homeworkList">
                        <li style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                            Noch keine Hausaufgaben vorhanden
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Notes Page -->
            <div id="notes" class="page">
                <div class="notes-container">
                    <div class="notes-form">
                        <h2>Neue Notiz</h2>
                        <div class="form-group">
                            <label>Titel</label>
                            <input type="text" id="noteTitle" placeholder="Notiz Titel">
                        </div>
                        <div class="form-group">
                            <label>Inhalt</label>
                            <textarea id="noteContent" placeholder="Schreib deine Notiz..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="createNote()" style="width: 100%;">Speichern</button>
                    </div>

                    <div class="notes-list">
                        <h2>Meine Notizen</h2>
                        <div id="notesList">
                            <p style="text-align: center; color: var(--text-secondary);">Noch keine Notizen</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Page -->
            <div id="chat" class="page">
                <div class="chat-container">
                    <h2 style="margin-bottom: 1rem;">Chat</h2>
                    <div class="chat-messages" id="chatMessages">
                        <p style="text-align: center; color: var(--text-secondary);">Keine Nachrichten</p>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chatInput" placeholder="Schreib eine Nachricht..." onkeypress="handleChatKeypress(event)">
                        <button class="btn btn-primary" onclick="sendMessage()">Senden</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Anmelden</h2>
                <button class="modal-close" onclick="toggleLoginModal()">√ó</button>
            </div>
            <div class="form-group">
                <label>Benutzername</label>
                <input type="text" id="loginUsername" placeholder="Dein Name">
            </div>
            <div class="form-group">
                <label>Rolle</label>
                <select id="loginRole">
                    <option value="student">Sch√ºler</option>
                    <option value="teacher">Lehrer</option>
                </select>
            </div>
            <div id="teacherCodeField" class="form-group hidden">
                <label>Lehrer Code</label>
                <input type="password" id="teacherCode" placeholder="Code eingeben">
            </div>
            <button class="btn btn-primary" onclick="login()" style="width: 100%; margin-top: 1rem;">Anmelden</button>
        </div>
    </div>

    <!-- Teacher Modal -->
    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Lehrer Modus</h2>
                <button class="modal-close" onclick="toggleTeacherModal()">√ó</button>
            </div>
            <p style="margin-bottom: 1rem; color: var(--text-secondary);">Gib den Lehrer Code ein um Hausaufgaben zu erstellen</p>
            <div class="form-group">
                <label>Lehrer Code</label>
                <input type="password" id="teacherCodeInput" placeholder="Code eingeben">
            </div>
            <button class="btn btn-primary" onclick="unlockTeacherMode()" style="width: 100%;">Freischalten</button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>¬© 2025 Student Portal. Erstellt f√ºr Sch√ºler.</p>
    </footer>

    <script>
        // Data Storage
        const data = {
            user: {
                name: 'Gast',
                role: 'student',
                isTeacher: false
            },
            homework: [],
            notes: [],
            messages: [],
            gameScores: [],
            completedHomework: new Set()
        };

        // Teacher Codes
        const TEACHER_CODE = 'Lehrer22';
        const ADMIN_CODE = 'ADMIN24';

        // Initialize
        function init() {
            loadData();
            updateUI();
            initGame();
        }

        // Data Management
        function saveData() {
            localStorage.setItem('studentPortalData', JSON.stringify({
                user: data.user,
                homework: data.homework,
                notes: data.notes,
                messages: data.messages,
                gameScores: data.gameScores,
                completedHomework: Array.from(data.completedHomework)
            }));
        }

        function loadData() {
            const saved = localStorage.getItem('studentPortalData');
            if (saved) {
                const loaded = JSON.parse(saved);
                data.user = loaded.user || data.user;
                data.homework = loaded.homework || [];
                data.notes = loaded.notes || [];
                data.messages = loaded.messages || [];
                data.gameScores = loaded.gameScores || [];
                data.completedHomework = new Set(loaded.completedHomework || []);
            }
        }

        // Navigation
        function switchPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageName).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');

            if (pageName === 'game') {
                updateLeaderboard();
            } else if (pageName === 'homework') {
                renderHomework();
            } else if (pageName === 'notes') {
                renderNotes();
            } else if (pageName === 'chat') {
                renderChat();
            }
        }

        // Authentication
        function toggleLoginModal() {
            document.getElementById('loginModal').classList.toggle('active');
        }

        function toggleTeacherModal() {
            document.getElementById('teacherModal').classList.toggle('active');
        }

        function toggleTeacherForm() {
            document.getElementById('teacherForm').classList.toggle('hidden');
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const role = document.getElementById('loginRole').value;
            const code = document.getElementById('teacherCode').value;

            if (!username) {
                alert('Bitte gib einen Namen ein');
                return;
            }

            if (role === 'teacher') {
                if (code !== TEACHER_CODE && code !== ADMIN_CODE) {
                    alert('Falscher Code');
                    return;
                }
                data.user.role = code === ADMIN_CODE ? 'admin' : 'teacher';
                data.user.isTeacher = true;
            } else {
                data.user.role = 'student';
                data.user.isTeacher = false;
            }

            data.user.name = username;
            saveData();
            updateUI();
            toggleLoginModal();
        }

        function unlockTeacherMode() {
            const code = document.getElementById('teacherCodeInput').value;
            if (code === TEACHER_CODE || code === ADMIN_CODE) {
                data.user.isTeacher = true;
                data.user.role = code === ADMIN_CODE ? 'admin' : 'teacher';
                saveData();
                updateUI();
                toggleTeacherModal();
                toggleTeacherForm();
                alert('Lehrer Modus aktiviert!');
            } else {
                alert('Falscher Code');
            }
        }

        function updateUI() {
            document.getElementById('userName').textContent = data.user.name;
            document.getElementById('userRole').textContent = data.user.isTeacher ? '(Lehrer)' : '(Sch√ºler)';
            
            if (data.user.isTeacher) {
                document.getElementById('teacherForm').classList.remove('hidden');
            }
        }

        // Homework
        function createHomework() {
            const title = document.getElementById('hwTitle').value;
            const subject = document.getElementById('hwSubject').value;
            const dueDate = document.getElementById('hwDueDate').value;
            const description = document.getElementById('hwDescription').value;

            if (!title) {
                alert('Bitte gib einen Titel ein');
                return;
            }

            const homework = {
                id: Date.now(),
                title,
                subject,
                dueDate: new Date(dueDate),
                description,
                createdBy: data.user.name,
                createdAt: new Date()
            };

            data.homework.push(homework);
            saveData();
            renderHomework();

            document.getElementById('hwTitle').value = '';
            document.getElementById('hwSubject').value = '';
            document.getElementById('hwDueDate').value = '';
            document.getElementById('hwDescription').value = '';
            toggleTeacherForm();
            alert('Hausaufgabe erstellt!');
        }

        function renderHomework() {
            const list = document.getElementById('homeworkList');
            if (data.homework.length === 0) {
                list.innerHTML = '<li style="text-align: center; color: var(--text-secondary); padding: 2rem;">Noch keine Hausaufgaben vorhanden</li>';
                return;
            }

            list.innerHTML = data.homework.map(hw => {
                const dueDate = new Date(hw.dueDate);
                const now = new Date();
                const diffTime = dueDate - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                let dateClass = '';
                let dateText = '';
                
                if (diffDays < 0) {
                    dateClass = 'due-date-overdue';
                    dateText = '√úberf√§llig';
                } else if (diffDays <= 1) {
                    dateClass = 'due-date-warning';
                    dateText = 'Morgen f√§llig!';
                } else {
                    dateText = dueDate.toLocaleDateString('de-DE');
                }

                const isCompleted = data.completedHomework.has(hw.id);

                return `
                    <li class="homework-item">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div class="homework-title">${hw.title}</div>
                                <div class="homework-meta">
                                    ${hw.subject ? `<span class="homework-meta-item">üìö ${hw.subject}</span>` : ''}
                                    <span class="homework-meta-item ${dateClass}">üìÖ ${dateText}</span>
                                </div>
                                ${hw.description ? `<div class="homework-description">${hw.description}</div>` : ''}
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Von: ${hw.createdBy}</div>
                            </div>
                            <div class="homework-actions">
                                ${!data.user.isTeacher ? `
                                    <button class="btn btn-small ${isCompleted ? 'btn-primary' : 'btn-secondary'}" onclick="toggleHomeworkCompletion(${hw.id})">
                                        ${isCompleted ? '‚úì Erledigt' : '‚òê Abhaken'}
                                    </button>
                                ` : ''}
                                ${data.user.isTeacher ? `
                                    <button class="btn btn-danger btn-small" onclick="deleteHomework(${hw.id})">L√∂schen</button>
                                ` : ''}
                            </div>
                        </div>
                    </li>
                `;
            }).join('');
        }

        function toggleHomeworkCompletion(id) {
            if (data.completedHomework.has(id)) {
                data.completedHomework.delete(id);
            } else {
                data.completedHomework.add(id);
            }
            saveData();
            renderHomework();
        }

        function deleteHomework(id) {
            if (confirm('Wirklich l√∂schen?')) {
                data.homework = data.homework.filter(hw => hw.id !== id);
                saveData();
                renderHomework();
            }
        }

        // Notes
        function createNote() {
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').value;

            if (!title || !content) {
                alert('Bitte f√ºll alle Felder aus');
                return;
            }

            const note = {
                id: Date.now(),
                title,
                content,
                createdAt: new Date()
            };

            data.notes.push(note);
            saveData();
            renderNotes();

            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            alert('Notiz gespeichert!');
        }

        function renderNotes() {
            const list = document.getElementById('notesList');
            if (data.notes.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Noch keine Notizen</p>';
                return;
            }

            list.innerHTML = data.notes.map(note => `
                <div class="note-card">
                    <div class="note-title">${note.title}</div>
                    <div class="note-content">${note.content}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="note-date">${new Date(note.createdAt).toLocaleDateString('de-DE')}</div>
                        <button class="btn btn-danger btn-small" onclick="deleteNote(${note.id})">L√∂schen</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteNote(id) {
            if (confirm('Notiz l√∂schen?')) {
                data.notes = data.notes.filter(n => n.id !== id);
                saveData();
                renderNotes();
            }
        }

        // Chat
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            const msg = {
                id: Date.now(),
                author: data.user.name,
                content: message,
                timestamp: new Date()
            };

            data.messages.push(msg);
            saveData();
            renderChat();
            input.value = '';
        }

        function handleChatKeypress(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }

        function renderChat() {
            const container = document.getElementById('chatMessages');
            if (data.messages.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Keine Nachrichten</p>';
                return;
            }

            container.innerHTML = data.messages.map(msg => `
                <div class="message">
                    <div class="message-author">${msg.author}</div>
                    <div class="message-content">${msg.content}</div>
                    <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString('de-DE')}</div>
                </div>
            `).join('');

            container.scrollTop = container.scrollHeight;
        }

        // Game
        let gameRunning = false;
        let gameScore = 0;
        let playerY = 0;
        let playerVelocity = 0;
        let obstacles = [];
        const GRAVITY = 0.6;
        const JUMP_STRENGTH = -12;

        function initGame() {
            const canvas = document.getElementById('gameCanvas');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }

        function startGame() {
            gameRunning = true;
            gameScore = 0;
            playerY = 150;
            playerVelocity = 0;
            obstacles = [];
            gameLoop();
        }

        function resetGame() {
            gameRunning = false;
            gameScore = 0;
            playerY = 150;
            playerVelocity = 0;
            obstacles = [];
            document.getElementById('gameScore').textContent = '0';
            drawGame();
        }

        function gameLoop() {
            if (!gameRunning) return;

            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');

            // Physics
            playerVelocity += GRAVITY;
            playerY += playerVelocity;

            // Boundaries
            if (playerY > canvas.height - 30) {
                playerY = canvas.height - 30;
                playerVelocity = 0;
            }

            // Obstacles
            if (Math.random() < 0.02) {
                obstacles.push({ x: canvas.width, y: canvas.height - 30 });
            }

            obstacles = obstacles.filter(obs => {
                obs.x -= 5;
                return obs.x > 0;
            });

            // Collision
            obstacles.forEach(obs => {
                if (playerY + 20 > obs.y && playerY < obs.y + 30 && obs.x < 50 && obs.x + 20 > 0) {
                    gameRunning = false;
                    saveScore();
                }
            });

            gameScore += 1;
            document.getElementById('gameScore').textContent = gameScore;

            drawGame();
            requestAnimationFrame(gameLoop);
        }

        function drawGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');

            // Clear
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Ground
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

            // Player
            ctx.fillStyle = '#FF6B6B';
            ctx.fillRect(30, playerY, 20, 20);

            // Obstacles
            ctx.fillStyle = '#4A90E2';
            obstacles.forEach(obs => {
                ctx.fillRect(obs.x, obs.y, 20, 30);
            });
        }

        function saveScore() {
            const score = {
                player: data.user.name,
                score: gameScore,
                date: new Date()
            };
            data.gameScores.push(score);
            data.gameScores.sort((a, b) => b.score - a.score);
            data.gameScores = data.gameScores.slice(0, 10);
            saveData();
            updateLeaderboard();
        }

        function updateLeaderboard() {
            const list = document.getElementById('leaderboard');
            if (data.gameScores.length === 0) {
                list.innerHTML = '<li class="leaderboard-item"><span class="leaderboard-rank">-</span><span>Noch keine Scores</span></li>';
                return;
            }

            list.innerHTML = data.gameScores.map((score, i) => `
                <li class="leaderboard-item">
                    <span class="leaderboard-rank">${i + 1}.</span>
                    <span>${score.player}</span>
                    <span style="font-weight: bold; color: var(--primary);">${score.score}</span>
                </li>
            `).join('');
        }

        document.getElementById('loginRole').addEventListener('change', (e) => {
            const codeField = document.getElementById('teacherCodeField');
            if (e.target.value === 'teacher') {
                codeField.classList.remove('hidden');
            } else {
                codeField.classList.add('hidden');
            }
        });

        // Start
        init();
    </script>
</body>
</html>
